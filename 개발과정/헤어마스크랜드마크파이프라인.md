# Eye Mask Refinement Log - Subtract & Dilate Strategy

>  ëª©ì : í¬ë¯¸í•˜ê²Œ ë‚¨ì•„ìˆëŠ” ëˆˆ ì£¼ë³€ ì˜ì—­ì„ HairMaskì—ì„œ ëª…í™•í•˜ê²Œ ì œê±°í•˜ê¸° ìœ„í•œ ë§ˆìŠ¤í¬ í™•ì¥ ì „ëµ  
>  ì‹¤í—˜ì¼: 2025-05-27  


---

## ğŸ¯ ì‹¤í—˜ ëª©ì 

- ê¸°ì¡´ subtractMask ì²˜ë¦¬ì—ì„œ eyeMaskì˜ ì¼ë¶€ê°€ **í¬ë¯¸í•˜ê²Œ ë‚¨ì•„ ì œê±°ë˜ì§€ ì•ŠìŒ**
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **ëˆˆ ë§ˆìŠ¤í¬ í™•ì¥(dilation)** ì „ëµì„ ì ìš©
- í™•ì¥ëœ ë§ˆìŠ¤í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ hairMaskì—ì„œ ë³´ë‹¤ ì •í™•í•œ ì˜ì—­ ì œê±°ë¥¼ ìˆ˜í–‰



### ê¸°ì¡´ì— ìƒê²¼ë˜ ë¬¸ì œ ì‚¬ì§„ vs í•´ê²°ëœ ì‚¬ì§„


| <center>eyeMaskRaw2 ì›ë³¸ ë§ˆìŠ¤í¬</center>                                                                               | dilatedEyeMask ì ìš©í›„ ì¶”ì¶œ                                                                                |
| ---------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| ![image](https://github.com/user-attachments/assets/42de04c4-d7a9-45eb-9af8-1c6eeda3faf6) | ![image](https://github.com/user-attachments/assets/3f8880cd-78be-47aa-b682-df16cf43a33d) |



---


## ğŸ“Š ë§ˆìŠ¤í¬ ì•ŒíŒŒ íˆìŠ¤í† ê·¸ë¨ ë¶„ì„

### âœ… eyeMaskRaw2 (ì›ë³¸ ë§ˆìŠ¤í¬)

```
alpha = 0        : 116,884
alpha 255        : 924
```

### âœ… dilatedEyeMask (í™•ì¥ëœ ë§ˆìŠ¤í¬)

```
alpha = 0        : 116,249
alpha 255        : 1,559
```

â†’ **+635 í”½ì…€** í™•ì¥ë¨  
â†’ Soft ê²½ê³„ ì˜ì—­ê¹Œì§€ í¬í•¨ëœ ëˆˆ ë§ˆìŠ¤í¬ ìƒì„± ì„±ê³µ

---

## ì ìš© ì½”ë“œ ìš”ì•½ ( EnhanceViewmodel ì½”ë“œ í…ŒìŠ¤íŠ¸ í›„ push ì˜ˆì •)

```kotlin
val eyeMaskRaw2 = createEyeMaskFromLandmarks(landmarks, width, height)

val dilatedEyeMask = dilateAlphaMask(binaryEyeMask, radius = 3.0) //ëˆˆ ì˜ì—­ ë²”ìœ„ë¥¼ í™•ì¥ ì‹œí‚´

val refinedHairMask = FacialPartMaskUtil.subtractMask(hairMask, dilatedEyeMask, threshold = 1)
```

- `dilateAlphaMask()` â†’ ë§ˆìŠ¤í¬ ì™¸ê³½ í™•ì¥
- `subtractMask()` â†’ ì œê±° ê²½ê³„ ê°•í™”

---

## ğŸ” ì‹œê°í™” ê²°ê³¼ ì €ì¥

```kotlin
saveImageToGallery(context, ConvertMask.createDebugAlphaMaskVisual(binaryEyeMask), "eyeMask_binary")
saveImageToGallery(context, ConvertMask.createDebugAlphaMaskVisual(dilatedEyeMask), "eyeMask_dilated")
saveImageToGallery(context, ConvertMask.createDebugAlphaMaskVisual(refinedHairMask), "hairMask_refined")
```

---

## ğŸ§  ì‹¤í—˜ ê²°ë¡ 

| í•­ëª©              | ê²°ê³¼                              |
|-------------------|-----------------------------------|
| ë§ˆìŠ¤í¬ í™•ì¥ ì—¬ë¶€   | âœ… ì„±ê³µ (924 â†’ 1559í”½ì…€ë¡œ ì¦ê°€)     |
| í¬ë¯¸í•œ ëˆˆ ì˜ì—­ ì œê±° | âœ… ë” ë§ì€ ì˜ì—­ ì œê±° ê°€ëŠ¥í•´ì§        |
| subtractMask íš¨ìœ¨  | âœ… ê²½ê³„ ì œê±° ì •í™•ë„ ì¦ê°€             |
| ì‹œê°ì  ì°¨ì´        | âœ… ëˆˆ ì˜ì—­ ì£¼ë³€ì´ ê¹¨ë—í•´ì§ (í™•ì¸ í•„ìš”) |

---

## ğŸ”§ í–¥í›„ ê°œì„ /í™•ì¥ ì•„ì´ë””ì–´

- hairFilter ë¥¼ ì²˜ë¦¬í›„ ì´ë¯¸ì§€ ê²°í•©í›„ì— ë§Œì•½ ëˆˆì¹ ì˜ì—­ë„ í•„ìš”í•˜ë‹¤ë©´ ëˆˆì¹ ì˜ì—­ë„ í¬í•¨í•´ì„œ ì¶”ì¶œí•  ì˜ˆì • subtractMask í›„
- 


---
