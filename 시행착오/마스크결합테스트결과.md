# ë§ˆìŠ¤í¬ ê²°í•© ë¬¸ì œ í•´ê²° ê¸°ë¡

## ğŸ“Š ì‹¤í—˜: Soft Alpha Mask vs Hard Alpha Mask

### âœ… í•´ê²° ë°°ê²½:

`SegmentationMask` ëª¨ë¸ì˜ bufferì—ì„œ ì•ŒíŒŒ ë§ˆìŠ¤í¬ë¥¼ ìƒì„±í•  ë•Œ,
confidence ê°’ì´ ì§€ì •ëœ thresholdë³´ë‹¤ ë†’ìœ¼ë©´ 255, ê·¸ ì´í•˜ëŠ” 0ìœ¼ë¡œ ì„¤ì •í•œ **Hard Alpha Mask** ë°©ì‹ì´ ë” ì •êµí•˜ê³  ì•ˆì •ì ì¸ ê²°ê³¼ë¥¼ ë³´ì˜€ë‹¤.

```kotlin
fun toHardAlphaMask(
    mask: SegmentationMask,
    width: Int,
    height: Int,
    threshold: Float = 0.6f
): Bitmap {
    val buffer = mask.buffer
    buffer.rewind()
    val pixels = IntArray(width * height)

    for (i in pixels.indices) {
        val confidence = buffer.float
        val alpha = if (confidence >= threshold) 255 else 0
        pixels[i] = (alpha shl 24) or 0xFFFFFF
    }

    return Bitmap.createBitmap(pixels, width, height, Bitmap.Config.ARGB_8888)
}

fun toSoftAlphaMask(
    mask: SegmentationMask,
    width: Int,
    height: Int
): Bitmap {
    val buffer = mask.buffer
    buffer.rewind()
    val pixels = IntArray(width * height)

    for (i in pixels.indices) {
        val confidence = buffer.float
        val alpha = (confidence * 255).toInt().coerceIn(0, 255)
        pixels[i] = (alpha shl 24) or 0xFFFFFF
    }

    return Bitmap.createBitmap(pixels, width, height, Bitmap.Config.ARGB_8888)
}

```

### âœ‚ï¸ ì–¼êµ´ ì˜ì—­ ë§ˆìŠ¤í¬ ë¹„êµ


| Soft Alpha Mask                                                                                | Hard Alpha Mask                                                                                |
| ---------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| ![Soft Alpha](https://github.com/user-attachments/assets/90dba699-0d38-4016-ac5e-28d30e31ae5a) | ![Hard Alpha](https://github.com/user-attachments/assets/e03d444f-a8b9-4dce-aefc-312e821824b9) |
| ì‹ ë¢°ë„ ê¸°ë°˜ì˜ ë¶€ë“œëŸ¬ìš´ ì•ŒíŒŒ ë§ˆìŠ¤í¬                                                                            | ì„ê³„ê°’ ê¸°ì¤€ì˜ ì´ì§„í™”ëœ ì•ŒíŒŒ ë§ˆìŠ¤í¬                                                                            |


---

## ğŸ”¢ íŒ¨í„´ í†µê³„ ë°ì´í„°:

```
faceAlphaMask:
- alpha=0:     61632
- alpha=255:  164688

jawlineMask:
- alpha=0:     135054
- alpha=255:   91266

faceHairMask:
- alpha=0:     70450
- alpha=255:  155870
```

### ğŸ“Œ Soft maskë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

* alpha ê°’ì´ 1\~254ì¸ ê²½ê³„ í”½ì…€ì´ blending ì‹œ ì¤‘ê°„ê°’ìœ¼ë¡œ ì ìš©ë˜ì§€ ì•Šìœ¼ë©´ íš¨ê³¼ê°€ ë¬´ì‹œë¨
* ë¯¸ì„¸í•œ ê·¸ë¼ë°ì´ì…˜ í‘œí˜„ì´ ê°€ëŠ¥í•œ ëŒ€ì‹  ì²˜ë¦¬ ê²°ê³¼ê°€ ì˜ˆìƒ ì™¸ë¡œ ë²ˆì§ˆ ìˆ˜ ìˆìŒ

### ğŸ“Œ Hard maskë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

* 255/0 ìœ¼ë¡œ ì´ì§„ ì²˜ë¦¬ë˜ë¯€ë¡œ ë§ˆìŠ¤í‚¹/ë¸”ë Œë”© ì²˜ë¦¬ ê²°ê³¼ê°€ ëª…í™•í•¨
* ê²½ê³„ ì²˜ë¦¬ê°€ ë‚ ì¹´ë¡œìš¸ ìˆ˜ ìˆìœ¼ë‚˜ featheringì„ ë³‘í–‰í•˜ë©´ ìì—°ìŠ¤ëŸ¬ì›€ í™•ë³´ ê°€ëŠ¥


---

ì¢‹ìŠµë‹ˆë‹¤. `grayMat` ê³¼ `alphaMat` ê¸°ë°˜ ë§ˆìŠ¤í¬ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë¹„êµí•˜ê³ , `alpha` ê¸°ë°˜ ì²˜ë¦¬ë¡œ ê°œì„ ëœ ì •ë°€ë„ ë° ì¼ê´€ì„±ì„ ê°•ì¡°í•˜ëŠ” êµ¬ì¡°ë¡œ ë§ˆí¬ë‹¤ìš´ ë‚´ìš©ì„ ì•„ë˜ì™€ ê°™ì´ ë³´ì™„í•´ë“œë¦´ê²Œìš”:

---

## ğŸ›  ë¬¸ì œ í•´ê²° ê³¼ì •:

1. ê¸°ì¡´ì—ëŠ” `toGrayMat()` í•¨ìˆ˜ë¥¼ í†µí•´ ë§ˆìŠ¤í¬ë¥¼ ìƒì„±í–ˆìœ¼ë‚˜, ì´ ë°©ì‹ì€ ìƒ‰ìƒì˜ ë°ê¸°(Luminance)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´, **ì•ŒíŒŒ ì±„ë„ì´ ìˆëŠ” ì´ë¯¸ì§€ì— ëŒ€í•´ ë¶€ì •í™•í•œ ë§ˆìŠ¤í¬ê°€ ìƒì„±**ë¨
2. ì´ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ `toAlphaMat()`ì„ ë„ì…. **ì‹¤ì œ ì•ŒíŒŒ ì±„ë„ì„ ì§ì ‘ ì¶”ì¶œ**í•˜ì—¬ ë³´ë‹¤ ì •ë°€í•œ ë§ˆìŠ¤í¬ ìƒì„± ê°€ëŠ¥
3. í†µê³„ì ìœ¼ë¡œë„ SoftMaskë³´ë‹¤ëŠ” HardMaskì˜ blending ê²°ê³¼ê°€ ë”ìš± ì¼ê´€ë˜ê³  ìì—°ìŠ¤ëŸ¬ìš´ í’ˆì§ˆì„ ë³´ì„

---





| toGrayMat                                                                             |  toAlphaMat                                                                        |
| ---------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| ![íšŒìƒ‰ ì²˜ë¦¬ ë§ˆìŠ¤í¬](https://github.com/user-attachments/assets/bb99f226-c5ed-43c2-892b-37a17360337a) | ![ì•ŒíŒŒ ì²˜ë¦¬ ë§ˆìŠ¤í¬](https://github.com/user-attachments/assets/2a738020-58a7-404b-86c2-5214502af3b0) |




### ğŸ” ë¹„êµ í•¨ìˆ˜ ì •ì˜

```kotlin
// ğŸ”¸ ê¸°ì¡´ ë°©ì‹: ìƒ‰ìƒ ê¸°ë°˜ grayscale ë³€í™˜
fun toGrayMat(bitmap: Bitmap): Mat {
    val rgba = Mat()
    val gray = Mat()
    Utils.bitmapToMat(bitmap, rgba)
    Imgproc.cvtColor(rgba, gray, Imgproc.COLOR_RGBA2GRAY)
    rgba.release()
    return gray
}

// ğŸ”¹ ê°œì„ ëœ ë°©ì‹: ì•ŒíŒŒ ì±„ë„ ì§ì ‘ ì¶”ì¶œ
fun toAlphaMat(bitmap: Bitmap): Mat {
    val rgba = Mat()
    Utils.bitmapToMat(bitmap, rgba)

    val channels = mutableListOf<Mat>()
    Core.split(rgba, channels)
    val alpha = channels[3] // A ì±„ë„ë§Œ ì¶”ì¶œ

    channels.subList(0, 3).forEach { it.release() }
    rgba.release()

    return alpha
}
```

---

### ğŸ“Š ê²°ê³¼ ë¹„êµ: Histogram Log ë¶„ì„

| ë§ˆìŠ¤í¬ ì¢…ë¥˜        | ì‚¬ìš© ë°©ì‹          | ì•ŒíŒŒ = 255 (ë³´ì´ëŠ” í”½ì…€ ìˆ˜) | ì•ŒíŒŒ = 0 (íˆ¬ëª… ì˜ì—­) |
| ------------- | -------------- | ------------------- | -------------- |
| faceHairMask  | `toGrayMat()`  | 143,511             | 82,809         |
| faceHairMask  | `toAlphaMat()` | 156,106             | 70,214         |

---

### âœ… ê²°ë¡ 

* `grayMat` ë°©ì‹ì€ RGB ê¸°ë°˜ì´ë¼ ì•ŒíŒŒ ì •ë³´ë¥¼ ë°˜ì˜í•˜ì§€ ëª»í•˜ê³ , **ì´ë¯¸ì§€ê°€ ë°˜íˆ¬ëª…í•˜ê±°ë‚˜ ë§ˆìŠ¤í‚¹ëœ ê²½ìš° ë¶€ì •í™•**í•œ ê²°ê³¼ë¥¼ ìƒì„±
* `alphaMat` ë°©ì‹ì€ ì•ŒíŒŒ ì±„ë„ ìì²´ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— **íˆ¬ëª…ë„ ê¸°ë°˜ì˜ ì •ë°€í•œ ë§ˆìŠ¤í‚¹ êµ¬í˜„ì— ì í•©**
* íŠ¹íˆ `faceHairMask`ì˜ ê²°ê³¼ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯, `alphaMat`ì€ **í—¤ì–´ë¼ì¸ê³¼ ê°™ì´ ê²½ê³„ê°€ ëª¨í˜¸í•œ ì˜ì—­ì—ì„œë„ ë” ë§ì€ í”½ì…€ì„ ì¸ì‹**í•´ì£¼ë©°, ì´ëŠ” ë§ˆìŠ¤í¬ í’ˆì§ˆ í–¥ìƒì— ê¸°ì—¬í•¨

---



## ğŸª¶ Feathering ì²˜ë¦¬: ê²½ê³„ ë¶€ë“œëŸ½ê²Œ ë§Œë“¤ê¸°

Hard Alpha Mask ë°©ì‹ì€ ì„ ëª…í•œ ê²½ê³„ë¥¼ ì œê³µí•˜ì§€ë§Œ, ìì—°ìŠ¤ëŸ¬ìš´ ë¸”ë Œë”©ì„ ìœ„í•´ì„œëŠ” **Feathering(ê²½ê³„ íë¦¼)** ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ `GaussianBlur`ë¥¼ í™œìš©í•˜ì—¬ ì•ŒíŒŒ ì±„ë„ì˜ ê²½ê³„ë¥¼ ë¶€ë“œëŸ½ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ í•¨ìˆ˜ëŠ” **ARGB\_8888 í˜•ì‹ì˜ ë§ˆìŠ¤í¬ì—ì„œ ì•ŒíŒŒ ì±„ë„ì„ ì¶”ì¶œí•˜ê³  Gaussian Blurë¡œ Feathering**í•œ í›„, ë‹¤ì‹œ ì›ë³¸ì— ì ìš©í•˜ì—¬ ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### ğŸ“¦ Feathering ì ìš© í•¨ìˆ˜

```kotlin
fun featherAlphaMask2(mask: Bitmap, radius: Double = 3.0): Bitmap {
    val mat = Mat()
    Utils.bitmapToMat(mask, mat)

    val channels = ArrayList<Mat>()
    Core.split(mat, channels)

    val alpha = channels.getOrNull(3)
        ?: throw IllegalStateException("Alpha channel not found")

    val safeAlpha = Mat()
    alpha.convertTo(safeAlpha, CvType.CV_8UC1) // ì•ˆì „í•˜ê²Œ 8-bit ë‹¨ì¼ ì±„ë„ë¡œ ë³€í™˜

    Imgproc.GaussianBlur(safeAlpha, safeAlpha, Size(radius, radius), 0.0) // Feathering í•µì‹¬

    channels[3] = safeAlpha
    Core.merge(channels, mat)

    val result = Bitmap.createBitmap(mask.width, mask.height, Bitmap.Config.ARGB_8888)
    Utils.matToBitmap(mat, result)
    return result
}
```

### âœ¨ ì ìš© ì „í›„ ë¹„êµ

| Hard Alpha Mask (Feathering ì „)                                                                 | Feathered Alpha Mask (í›„)                                                              |
| ---------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| ![image](https://github.com/user-attachments/assets/ddb60cf0-d267-4777-ab3d-ecb262d88146)| ![image](https://github.com/user-attachments/assets/869df1ee-65b5-46ed-8abd-838a78be023c) |

### ğŸ¯ Feathering ì ìš© íš¨ê³¼

* Sharpí•œ ê²½ê³„ë§Œ ìˆëŠ” Hard Maskì— Featheringì„ ì ìš©í•˜ë©´, **ë³´ë‹¤ ìì—°ìŠ¤ëŸ½ê²Œ ì–¼êµ´/ë¨¸ë¦¬ì¹´ë½ ì˜ì—­ì´ ë°°ê²½ê³¼ ìœµí™”ë¨**
* íŠ¹íˆ **ë¨¸ë¦¬ì¹´ë½ ê²½ê³„**, **í„±ì„ **, **ê·€ ì£¼ë³€** ë“± ê²½ê³„ê°€ ì„ ëª…í•˜ì§€ ì•Šì€ ì˜ì—­ì— íš¨ê³¼ì 
* feather radiusëŠ” ìƒí™©ì— ë”°ë¼ ì¡°ì ˆ ê°€ëŠ¥ (ê¸°ë³¸ê°’ `3.0`)

---

##  ì¢…í•© ê²°ë¡ 

* `alphaMat` ê¸°ë°˜ìœ¼ë¡œ Hard Maskë¥¼ ìƒì„±í•˜ë©´ ë§ˆìŠ¤í¬ì˜ ì •ë°€ë„ì™€ ì¼ê´€ì„±ì´ í–¥ìƒë¨
* ì´í›„ `featherAlphaMask2()` í•¨ìˆ˜ë¡œ ë¶€ë“œëŸ¬ìš´ Featheringì„ ì ìš©í•˜ë©´, **ë‚ ì¹´ë¡œìš´ ê²½ê³„ì˜ ì‹œê°ì  ìœ„í™”ê°ì„ ì¤„ì¼ ìˆ˜ ìˆìŒ**
* ì „ì²´ í¬íŠ¸ë ˆì´íŠ¸ íš¨ê³¼ ì‹œìŠ¤í…œì˜ ìì—°ìŠ¤ëŸ¬ì›€ê³¼ ê³ ê¸‰ìŠ¤ëŸ¬ì›€ì„ ê°•í™”í•˜ëŠ” í•µì‹¬ ë‹¨ê³„

---


## ğŸ’¡ ê²°ë¡ :

* "ë¨¸ë¦¬ì¹´ë½ê³¼ ì–¼êµ´ì„ í¬í•¨í•œ ìµœì¢… ë§ˆìŠ¤í¬"ëŠ” segmentMaskì™€ jawlineMaskê°€ ì •í™•í•œ alpha ì±„ë„ì„ ê°€ì§€ê³  ìˆì–´ì•¼ ì •í™•í•œ ì˜ì—­ ë¸”ë Œë”©ì´ ê°€ëŠ¥
* SoftMaskëŠ” blending ê°•ë„ë‚˜ feathering ì¡°ê±´ì´ ì •ë°€í•˜ì§€ ì•Šìœ¼ë©´ íš¨ê³¼ê°€ ë°˜ì˜ë˜ì§€ ì•ŠìŒ
* HardMaskëŠ” ì›í•˜ëŠ” ì˜ì—­ë§Œ ì •í™•í•˜ê²Œ ì²˜ë¦¬ ê°€ëŠ¥í•˜ë©°, feather ë§ˆìŠ¤í¬ë¡œ ë¶€ë“œëŸ¬ìš´ ê²½ê³„ êµ¬í˜„ì´ ê°€ëŠ¥

---


